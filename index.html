<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ギアオタッド暗号</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #eef2f3; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        textarea { width: 95%; height: 120px; margin: 10px 0; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        textarea:focus { border-color: #007bff; outline: none; }
        .btn-group { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        button { padding: 10px 18px; font-size: 15px; cursor: pointer; border: none; border-radius: 6px; background-color: #007bff; color: white; transition: 0.2s; font-weight: bold; }
        button:hover { background-color: #0056b3; transform: translateY(-1px); }
        .swap-btn { background-color: #6f42c1; }
        .copy-btn { background-color: #28a745; }
        .label { font-weight: bold; display: block; margin-top: 15px; text-align: left; margin-left: 2.5%; color: #333; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <h2>⚙️ ギアオタッド暗号</h2>
    <span class="label">入力（日本語・数字・暗号）:</span>
    <textarea id="inputText" placeholder="ここにメッセージを入力..."></textarea>
    <div class="btn-group">
        <button onclick="process('encrypt')">暗号化</button>
        <button onclick="process('decrypt')">復号</button>
        <button class="swap-btn" onclick="swapText()">入れ換える &#x1F503;</button>
        <button class="copy-btn" onclick="copyText('inputText')">入力をコピー</button>
    </div>
    <hr>
    <span class="label">結果:</span>
    <textarea id="outputText" readonly placeholder="結果が表示されます..."></textarea>
    <div class="btn-group">
        <button class="copy-btn" onclick="copyText('outputText')">結果をコピー</button>
        <button style="background-color: #dc3545;" onclick="clearAll()">全て消去</button>
    </div>
</div>

<script>
    const mapping = {
        'あ': 'ぬ', 'い': 'わ', 'う': 'ん', 'え': 'え', 'お': 'お',
        'か': 'き', 'き': 'く', 'く': 'け', 'け': 'こ', 'こ': 'か',
        'さ': 'し', 'し': 'す', 'す': 'せ', 'せ': 'そ', 'そ': 'さ',
        'た': 'ち', 'ち': 'つ', 'つ': 'て', 'て': 'と', 'と': 'た',
        'な': 'に', 'に': 'ぬ', 'ぬ': 'ね', 'ね': 'の', 'の': 'な',
        'は': 'ひ', 'ひ': 'ふ', 'ふ': 'へ', 'へ': 'ほ', 'ほ': 'は',
        'ま': 'み', 'み': 'む', 'む': 'め', 'め': 'も', 'も': 'ま',
        'や': 'ゆ', 'ゆ': 'よ', 'よ': 'や',
        'ら': 'り', 'り': 'る', 'る': 'れ', 'れ': 'ろ', 'ろ': 'ら',
        'わ': 'を', 'を': 'ん', 'ん': 'わ',
        '0': '⦰', '1': '⦑', '2': '⦒', '3': '⦓', '4': '⦔',
        '5': '⦕', '6': '⦖', '7': '⦗', '8': '⦘', '9': '⦙'
    };

    const reverseMapping = Object.fromEntries(Object.entries(mapping).map(([k, v]) => [v, k]));

    function process(mode) {
        const input = document.getElementById('inputText').value;
        const dict = (mode === 'encrypt') ? mapping : reverseMapping;
        let result = "";
        
        // 絵文字・特殊文字対応の分割
        const chars = Array.from(input);

        for (let char of chars) {
            let hiraChar = char.replace(/[\u30a1-\u30f6]/g, s => String.fromCharCode(s.charCodeAt(0) - 0x60));
            if (dict[hiraChar]) {
                result += dict[hiraChar];
            } else if (dict[char]) {
                result += dict[char];
            } else {
                result += char;
            }
        }
        document.getElementById('outputText').value = result;
    }

    function swapText() {
        const inputArea = document.getElementById('inputText');
        const outputArea = document.getElementById('outputText');
        const temp = inputArea.value;
        inputArea.value = outputArea.value;
        outputArea.value = temp;
    }

    function copyText(areaId) {
        const text = document.getElementById(areaId);
        if (!text.value) return;
        text.select();
        document.execCommand('copy');
        alert("コピーしました！");
    }

    function clearAll() {
        if(confirm("すべて消去しますか？")) {
            document.getElementById('inputText').value = '';
            document.getElementById('outputText').value = '';
        }
    }
</script>
</body>
</html>    <div id="debug" class="debug-info">ここに工程が表示されます</div>
</div>

<script>
// 基本変換マップ
const rToK = {"shi":"し","chi":"ち","tsu":"つ","kya":"きゃ","kyu":"きゅ","kyo":"きょ","sha":"しゃ","shu":"しゅ","sho":"しょ","cha":"ちゃ","chu":"ちゅ","cho":"ちょ","nya":"にゃ","nyu":"にゅ","nyo":"にょ","hya":"ひゃ","hyu":"ひゃ","hyo":"ひょ","mya":"みゃ","myu":"みゅ","myo":"みょ","rya":"りゃ","ryu":"りゃ","ryo":"りょ","gya":"ぎゃ","gyu":"ぎゅ","gyo":"ぎょ","ja":"じゃ","ju":"じゅ","jo":"じょ","bya":"びゃ","byu":"びゅ","byo":"びょ","pya":"ぴゃ","pyu":"ぴゅ","pyo":"ぴょ","ka":"か","ki":"き","ku":"く","ke":"け","ko":"こ","sa":"さ","su":"す","se":"せ","so":"そ","ta":"た","te":"て","to":"と","na":"な","ni":"に","nu":"ぬ","ne":"ね","no":"の","ha":"は","hi":"ひ","fu":"ふ","he":"へ","ho":"ほ","ma":"ま","mi":"み","mu":"む","me":"め","mo":"も","ya":"や","yu":"ゆ","yo":"よ","ra":"ら","ri":"り","ru":"る","re":"れ","ro":"ろ","wa":"わ","wo":"を","nn":"ん","ga":"が","gi":"ぎ","gu":"ぐ","ge":"げ","go":"ご","za":"ざ","ji":"じ","zu":"ず","ze":"ぜ","zo":"ぞ","da":"だ","di":"ぢ","du":"づ","de":"で","do":"ど","ba":"ば","bi":"び","bu":"ぶ","be":"べ","bo":"ぼ","pa":"ぱ","pi":"ぴ","pu":"ぷ","pe":"ぺ","po":"ぽ","a":"あ","i":"い","u":"う","e":"え","o":"お"};
const kToR = Object.fromEntries(Object.entries(rToK).map(([k,v])=>[v,k]));
const kToM = {"ぬ":"1","ふ":"2","あ":"3","う":"4","え":"5","お":"6","や":"7","ゆ":"8","よ":"9","わ":"0","ほ":"-","へ":"^","た":"Q","て":"W","い":"E","す":"R","か":"T","ん":"Y","な":"U","に":"I","ら":"O","せ":"P","だ":"@","む":"[","ち":"A","と":"S","し":"D","は":"F","き":"G","く":"H","ま":"J","の":"K","り":"L","れ":";","け":":","つ":"Z","さ":"X","そ":"C","ひ":"V","こ":"B","み":"N","も":"M","ね":",","る":".","め":"/","ー":"-"};
const mToK = Object.fromEntries(Object.entries(kToM).map(([k,v])=>[v,k]));

function kataToHira(str) { return str.replace(/[ァ-ヶ]/g, s => String.fromCharCode(s.charCodeAt(0) - 0x60)); }
function rot47(t){ return t.split('').map(c=>{let n=c.charCodeAt(0);return(n>=33&&n<=126)?String.fromCharCode(33+((n-33+47)%94)):c}).join('');}

// エニグマ：全文字対応かつ位置ズレを完全修正
function enigmaStep(c, pos, reverse) {
    let n = c.charCodeAt(0);
    let shift = pos % 94; 
    if (n >= 33 && n <= 126) {
        if (!reverse) {
            return String.fromCharCode(33 + ((n - 33 + shift) % 94));
        } else {
            return String.fromCharCode(33 + ((n - 33 - shift + 94) % 94));
        }
    }
    return c;
}

function run(isEnc) {
    let input = document.getElementById('input').value;
    if(!input) return;
    let res = "";
    if(isEnc) {
        let s0 = kataToHira(input.toLowerCase());
        const sk = Object.keys(rToK).sort((a,b)=>b.length - a.length);
        for(let k of sk){ s0 = s0.split(k).join(rToK[k]); }
        let s1 = s0.split('').map(c=>kToM[c]||c).join('');
        let s2 = rot47(s1);
        // エニグマ変換
        let s3 = s2.split('').map((c, i) => enigmaStep(c, i, false)).join('');
        res = s3.split('').reverse().join('');
        document.getElementById('debug').innerText = `[暗号化] 完了`;
    } else {
        let s1 = input.split('').reverse().join('');
        // エニグマ戻し
        let s2 = s1.split('').map((c, i) => enigmaStep(c, i, true)).join('');
        let s3 = rot47(s2);
        let s4 = s3.split('').map(c=>mToK[c]||c).join('');
        const sk = Object.keys(kToR).sort((a,b)=>b.length - a.length);
        for(let k of sk){ s4 = s4.split(k).join(kToR[k]); }
        res = s4;
        document.getElementById('debug').innerText = `[復号化] 完了`;
    }
    document.getElementById('resultText').innerText = res;
}

function swap(){
    const currentRes = document.getElementById('resultText').innerText;
    if(currentRes) document.getElementById('input').value = currentRes;
}

function copyResult(){
    const t = document.getElementById('resultText').innerText;
    if(!t) return;
    // 古い端末でも動くコピー方式
    const textArea = document.createElement("textarea");
    textArea.value = t;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    alert("コピーしました");
}
</script>
</body>
</html>
<!--ジロジロ見んなや。ソースを。-->
